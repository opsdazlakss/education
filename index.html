<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAT - Eğitim Sistemi</title>
    <!-- Firebase CDN Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
            line-height: 1.6;
        }

        header {
            border-bottom: 1px solid #1e293b;
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(10px);
            position: static;
            top: 0;
            z-index: 40;
        }

        .header-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: linear-gradient(to bottom right, #3b82f6, #06b6d4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            color: white;
        }

        .logo-text h1 {
            font-size: 24px;
            font-weight: bold;
            color: white;
        }

        .logo-text p {
            font-size: 12px;
            color: #94a3b8;
        }

        .progress-section {
            text-align: right;
        }

        .progress-section p {
            font-size: 14px;
            color: #94a3b8;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            width: 130px;
            height: 6px;
            background-color: #1e293b;
            border-radius: 9999px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #3b82f6, #06b6d4);
            transition: width 0.3s ease;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 2rem;
        }
        @media (max-width: 768px) {
            header {
        position: static;
            }
    
    
            .stages-list {
       .header-content {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
       }         max-height: 300px; /* Daha da küçült */
            }
            
            /* İçerik kartını üste çıkar */
            .content-card {
                position: relative;
                z-index: 1;
            }
            
            .header-content > div:last-child {
                width: 100%;
                flex-direction: column;
                align-items: stretch;
            }
            
            .header-content > div:last-child > * {
                width: 100%;
                text-align: center;
            }
            
            .logo-text h1 {
                font-size: 20px;
            }
            
            .logo-icon {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
            
            .container {
                padding: 1rem;
            }
            
            .card-header {
                padding: 1.5rem;
            }
            
            .card-header h2 {
                font-size: 24px;
            }
            
            .card-body {
                padding: 1.5rem;
            }
            
            .modal-content {
                max-width: 95%;
                max-height: 90vh;
            }
            
            .modal-header {
                padding: 1.5rem;
            }
            
            .modal-body {
                padding: 1.5rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .stage-btn {
                min-height: auto;
                padding: 1rem;
            }
            
            .content-item {
                padding: 1rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }
            
            .content-emoji {
                font-size: 20px;
            }
            
            .content-check {
                position: absolute;
                top: 1rem;
                right: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .logo-text h1 {
                font-size: 18px;
            }
            
            .logo-text p {
                font-size: 11px;
            }
            
            .card-header h2 {
                font-size: 20px;
            }
            
            .stage-title {
                font-size: 14px;
            }
            
            .quiz-question {
                font-size: 16px;
            }
            
            .quiz-option {
                padding: 0.75rem 1rem;
                font-size: 14px;
            }
            
            .stages-list {
                max-height: 300px;
            }
        }
        @media (max-width: 480px) {
    .header-content {
        padding: 0.75rem;
    }
    
    .header-content > div:last-child {
        flex-direction: column; /* Çok küçük ekranda dikey */
        align-items: stretch;
    }
    
    .header-content > div:last-child > a,
    .header-content > div:last-child > button {
        width: 100%;
        text-align: center;
    }
    
    .progress-section {
        width: 100%;
        text-align: left;
    }
    
    .progress-bar {
        width: 100%;
    }
        }
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static; /* sticky'den static'e çevir */
                max-height: none; /* max-height sınırlamasını kaldır */
                margin-bottom: 2rem;
            }
            
            .stages-list {
                max-height: 400px;
                overflow-y: auto;
            }
        }


        .sidebar h2 {
            font-size: 12px;
            font-weight: 600;
            color: #cbd5e1;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }

        .stages-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .sp-embed-player {
            width: 100%;
            height: 100%;
            min-height: 400px;
        }
        
        .sp-embed-player iframe {
            width: 100%;
            height: 100%;
        }

        .stages-list::-webkit-scrollbar {
            width: 6px;
        }

        .stages-list::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.3);
            border-radius: 10px;
        }

        .stages-list::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 10px;
        }

        .stages-list::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.7);
        }

        .stage-btn {
            text-align: left;
            padding: 1.25rem;
            border-radius: 12px;
            border: 1px solid #334155;
            background: rgba(30, 41, 59, 0.4);
            color: #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            font-size: 14px;
            min-height: 100px;
            justify-content: space-between;
        }

        .stage-btn:hover:not(:disabled) {
            background: rgba(30, 41, 59, 0.6);
            border-color: #475569;
            transform: translateY(-2px);
        }

        .stage-btn.active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(6, 182, 212, 0.3));
            border: 2px solid rgba(59, 130, 246, 0.6);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        .stage-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: rgba(30, 41, 59, 0.2);
        }

        .stage-btn-header {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .stage-icon {
            font-size: 24px;
            flex-shrink: 0;
            margin-top: 0.25rem;
        }

        .stage-info {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .stage-title {
            font-size: 15px;
            font-weight: 600;
            color: #e2e8f0;
            line-height: 1.3;
        }

        .stage-type {
            font-size: 11px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stage-status {
            font-size: 12px;
            color: #64748b;
            margin-top: 0.5rem;
            padding-top: 0.75rem;
            border-top: 1px solid rgba(59, 130, 246, 0.2);
        }

        .content-card {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid #1e293b;
            border-radius: 12px;
            overflow: hidden;
        }

        .card-header {
            background: linear-gradient(to right, rgba(59, 130, 246, 0.1), rgba(6, 182, 212, 0.1));
            border-bottom: 1px solid #1e293b;
            padding: 2rem;
        }

        .card-header-top {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .stage-badge {
            padding: 0.5rem 0.75rem;
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 600;
            color: #93c5fd;
        }

        .card-header h2 {
            font-size: 32px;
            font-weight: bold;
            color: white;
            margin-bottom: 0.5rem;
        }

        .card-header p {
            color: #94a3b8;
            font-size: 14px;
        }

        .card-body {
            padding: 2rem;
        }

        .content-section {
            margin-bottom: 2rem;
        }

        .content-section h3 {
            font-size: 18px;
            font-weight: 600;
            color: white;
            margin-bottom: 1rem;
        }

        .content-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .content-item {
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #334155;
            background: rgba(30, 41, 59, 0.3);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 15px;
        }

        .content-item:hover {
            background: rgba(30, 41, 59, 0.5);
            border-color: #475569;
        }

        .content-item.completed {
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.3);
        }

        .content-emoji {
            font-size: 24px;
            flex-shrink: 0;
        }

        .content-details {
            flex: 1;
        }

        .content-title {
            font-weight: 500;
            color: #e2e8f0;
            margin-bottom: 0.25rem;
        }

        .content-type {
            font-size: 12px;
            color: #64748b;
        }

        .content-check {
            font-size: 24px;
            flex-shrink: 0;
        }

        .progress-section-card {
            background: rgba(30, 41, 59, 0.3);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .progress-header p {
            font-size: 14px;
            font-weight: 500;
            color: #cbd5e1;
        }

        .progress-count {
            font-size: 14px;
            font-weight: 600;
            color: #06b6d4;
        }
        .quiz-progress-info {
            font-size: 14px;
            color: #94a3b8;
            margin-bottom: 1rem;
            text-align: center;
        }

        .quiz-navigation {
            display: flex;
            justify-content: center;
        }

        .progress-bar-full {
            width: 100%;
            height: 8px;
            background-color: #1e293b;
            border-radius: 9999px;
            overflow: hidden;
        }

        .progress-fill-full {
            height: 100%;
            background: linear-gradient(to right, #06b6d4, #3b82f6);
            transition: width 0.3s ease;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn {
            flex: 1;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 15px;
        }

        .btn-secondary {
            border: 1px solid #475569;
            color: #cbd5e1;
            background: transparent;
        }

        .btn-secondary:hover {
            background: rgba(30, 41, 59, 0.5);
        }

        .btn-primary {
            background: linear-gradient(to right, #3b82f6, #06b6d4);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(to right, #2563eb, #0891b2);
        }

        .btn-primary:disabled {
            background: #475569;
            color: #64748b;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .info-card {
            margin-top: 1.5rem;
            background: rgba(15, 23, 42, 0.3);
            border: 1px solid #1e293b;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .info-card p {
            font-size: 14px;
            color: #94a3b8;
        }

        .info-card span {
            font-weight: 600;
            color: #cbd5e1;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 50;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            width: 100%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(to right, rgba(59, 130, 246, 0.1), rgba(6, 182, 212, 0.1));
            border-bottom: 1px solid #334155;
            padding: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }

        .modal-title-section h3 {
            font-size: 20px;
            font-weight: bold;
            color: white;
            margin-top: 0.5rem;
        }

        .modal-type {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            color: #94a3b8;
        }

        .close-btn {
            background: none;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            font-size: 24px;
            transition: color 0.2s;
        }

        .close-btn:hover {
            color: #e2e8f0;
        }

        .modal-body {
            padding: 2rem;
            flex: 1;
            overflow-y: auto;
        }

        .text-content {
            background: rgba(30, 41, 59, 0.3);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 1.5rem;
            color: #e2e8f0;
            white-space: pre-wrap;
            line-height: 1.8;
        }

        .video-container {
            aspect-ratio: 16 / 9;
            background: black;
            border-radius: 8px;
            overflow: hidden;
        }

        .video-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .link-box {
            background: rgba(30, 41, 59, 0.3);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .link-box p {
            color: #cbd5e1;
            margin-bottom: 1rem;
            font-size: 14px;
        }

        .link-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(to right, #3b82f6, #06b6d4);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
        }

        .link-btn:hover {
            background: linear-gradient(to right, #2563eb, #0891b2);
        }

        .link-url {
            font-size: 12px;
            color: #64748b;
            word-break: break-all;
            margin-top: 1rem;
        }

        .survey-questions {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .question-box {
            background: rgba(30, 41, 59, 0.3);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .question-number {
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 1rem;
            font-size: 14px;
        }

        .question-textarea {
            width: 100%;
            padding: 0.75rem;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 6px;
            color: #e2e8f0;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
            font-size: 14px;
        }

        .question-textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .submit-survey-btn {
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(to right, #3b82f6, #06b6d4);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            margin-top: 1rem;
        }

        .submit-survey-btn:hover {
            background: linear-gradient(to right, #2563eb, #0891b2);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-content">
    <a href="index.html" class="logo" style="text-decoration: none;">
      <div class="logo-icon">M</div>
      <div class="logo-text">
          <h1>MAT</h1>
          <p>Eğitim Sistemi</p>
      </div>
    </a>

    <div style="display: flex; gap: 1rem; align-items: center;">
        <div class="progress-section">
            <p>Aşama <span id="currentStageDisplay">1</span>/<span id="totalStageDisplay">9</span></p>
            <div class="progress-bar">
                <div class="progress-fill" id="headerProgressFill" style="width: 11.11%"></div>
            </div>
        </div>
        <!-- Admin butonu (sadece adminlere göster) -->
        <a href="admin.html" id="adminButton" style="display: none; padding: 0.5rem 1rem; background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.4); color: #3b82f6; border-radius: 6px; text-decoration: none; font-weight: 500; font-size: 14px;">🛠️ Admin</a>
        <a href="presenter.html" id="presenterButton"style="display: none; padding: 0.5rem 1rem; background: rgba(34, 197, 94, 0.2);border: 1px solid rgba(34, 197, 94, 0.4); color: #22c55e; border-radius: 6px;text-decoration: none; font-weight: 500; font-size: 14px;">🎤 Presenter</a>
        <button onclick="userLogout()" style="padding: 0.5rem 1rem; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.4); color: #ef4444; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 14px;">Çıkış</button>
    </div>
</div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <div class="main-grid">
            <!-- Sidebar -->
            <div class="sidebar">
                <h2>Aşamalar</h2>
                <div class="stages-list" id="stagesList"></div>
            </div>

            <!-- Main Content -->
            <div>
                <div class="content-card">
                    <div class="card-header">
                        <div class="card-header-top">
                            <div class="stage-badge">Aşama <span id="stageId">1</span></div>
                            <span id="stageTypeLabel">Konferans</span>
                        </div>
                        <h2 id="stageTitle">Proje Tanıtımı</h2>
                        <p id="stageDescription">MAT projesinin temel bilgileri ve hedefleri</p>
                    </div>

                    <div class="card-body">
                        <div class="content-section">
                            <h3>Aşama İçeriği</h3>
                            <div class="content-list" id="contentList"></div>
                        </div>

                        <div class="progress-section-card">
                            <div class="progress-header">
                                <p>Bu Aşamayı Tamamlama İlerlemesi</p>
                                <span class="progress-count"><span id="completedCount">0</span>/<span id="totalCount">4</span></span>
                            </div>
                            <div class="progress-bar-full">
                                <div class="progress-fill-full" id="stageProgressFill" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-secondary" id="prevBtn" style="display: none;">← Önceki</button>
                            <button class="btn btn-primary" id="nextBtn">Sonraki Aşama →</button>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <p>💡 <span>İpucu:</span> Bu aşamadaki tüm içeriği tamamladıktan sonra sonraki aşamaya geçebilirsiniz.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="contentModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-section">
                    <div class="modal-type" id="modalType">Metin</div>
                    <h3 id="modalTitle">İçerik Başlığı</h3>
                </div>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>
    
    <script src="firebase-config.js"></script>
    <script>
        let currentUser = null;
        let currentUsername = null;
        let userProgress = null;
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        window.location.href = 'login.html';
        return;
      }

      const userDoc = await db.collection('users').where('email', '==', user.email).get();
      if (!userDoc.empty) {
        const data = userDoc.docs[0].data();

        // Admin butonunu göster
        if (data.isAdmin) {
          document.getElementById('adminButton').style.display = 'inline-block';
        }

        // Presenter butonunu göster
        if (data.isPresenter) {
          document.getElementById('presenterButton').style.display = 'inline-block';
        }
      }
    });

        const quizQuestionPools = {
            1: [ // Stage 1 için soru havuzu
                {
                    question: 'MAT projesi hangi ilkelere dayanmaktadır?',
                    options: ['Kapalı kaynak', 'Açık kaynak', 'Ticari ürün'],
                    correctAnswer: 'Açık kaynak'
                },
                {
                    question: 'MAT hangi platformdur?',
                    options: ['Eğitim platformu', 'Oyun platformu', 'Alışveriş sitesi'],
                    correctAnswer: 'Eğitim platformu'
                },
                {
                    question: 'Topluluk desteği var mı?',
                    options: ['Evet', 'Hayır', 'Bazen'],
                    correctAnswer: 'Evet'
                },
                {
                    question: 'MAT projesi hangi amaçla kurulmuştur?',
                    options: ['Kar elde etmek', 'Eğitim sağlamak', 'Reklam yapmak'],
                    correctAnswer: 'Eğitim sağlamak'
                },
                {
                    question: 'Proje kaç katmandan oluşur?',
                    options: ['2', '3', '4'],
                    correctAnswer: '3'
                },
                {
                    question: 'Backend hangi dilde yazılmıştır?',
                    options: ['Python', 'JavaScript', 'Java'],
                    correctAnswer: 'JavaScript'
                },
                {
                    question: 'Veritabanı olarak ne kullanılır?',
                    options: ['MySQL', 'MongoDB', 'PostgreSQL'],
                    correctAnswer: 'MongoDB'
                },
                {
                    question: 'API tipi nedir?',
                    options: ['REST', 'GraphQL', 'SOAP'],
                    correctAnswer: 'REST'
                },
                {
                    question: 'Kimlik doğrulama nasıl yapılır?',
                    options: ['JWT', 'Session', 'Cookie'],
                    correctAnswer: 'JWT'
                },
                {
                    question: 'Frontend framework nedir?',
                    options: ['React', 'Vue', 'Angular'],
                    correctAnswer: 'React'
                }
            ],
            2: [ // Stage 2 için soru havuzu (örnek)
                {
                    question: 'MAT projesi kaç ana katmandan oluşmaktadır?',
                    options: ['2', '3', '4'],
                    correctAnswer: '3'
                },
                {
                    question: 'MAT projesi kaç ana katmandan oluşmaktadır?',
                    options: ['2', '3', '4'],
                    correctAnswer: '3'
                },
                {
                    question: 'MAT projesi kaç ana katmandan oluşmaktadır?',
                    options: ['2', '3', '4'],
                    correctAnswer: '3'
                },
                {
                    question: 'MAT projesi kaç ana katmandan oluşmaktadır?',
                    options: ['2', '3', '4'],
                    correctAnswer: '3'
                },
                {
                    question: 'MAT projesi kaç ana katmandan oluşmaktadır?',
                    options: ['2', '3', '4'],
                    correctAnswer: '3'
                },
                {
                    question: 'MAT projesi kaç ana katmandan oluşmaktadır?',
                    options: ['2', '3', '4'],
                    correctAnswer: '3'
                },
                // Soru eklemek için üstteki formatta devam keeeee
            ]
        };
        const stages = [
            {
                id: 1,
                title: "Proje Tanıtımı",
                description: "MAT projesinin temel bilgileri ve hedefleri",
                type: "Konferans",
                contents: [
                    { type: 'text', title: 'Networkde Çevre', icon: '📄', 
data: `
Network Marketing, geleneksel ticaret anlayışından oldukça farklı bir dünyadır. Bu alana adım attığımızda, işe dair birçok kalıplaşmış düşünceyi geride bırakmamız gerekir.

"Bu iş çevre işi. Çevresi fazla olan kişileri getirmem lazım" derseniz yanılırsınız. Çünkü geniş çevresi olan kişi de en fazla 4-5 kişiyi davet edebilirken, dar çevreye sahip olan kişi de aynı sayıda insanı getirebilir. Yani hayalimizde olan bir senaryo yaşanmayacaktır.

Genellikle çevresi geniş olan insanlar, özgüvenle birlikte bir miktar egoya da sahip olabilirler. Bilmedikleri konularda bile fikir beyan ettikleri için, onlara Network sistemini anlatmak çoğu zaman zordur. Onun yerine; çevresi bir nebze daha az olup, egosu olmayan kişilere anlatmak her zaman çok daha iyi sonuçlar verecektir.

**Geleneksel Ticaret Mantığı:**
Geleneksel bir iş kurarken; sermaye, çevre, bilgi lazımdır. Çevren olmadan veya yapacağın iş hakkında bir bilgin olmadan o işi yapamazsın.

**Pazarlama İşlemi:**
Pazarlama işinde de çok fazla çevre gereklidir. Bir müdür olsanız, elbette çevresi daha fazla olan kişiyi işe alırsınız. Çünkü pazarlamacı, kendi çevresine satış yapacaktır. Satışları yükselteceği için çevresi daha çok olan kişiyi tercih ederiz.

Fakat Network'ün pazarlama yöntemi böyle değildir. Network'e yeni başlayanların çoğu, klasik pazarlama mantığıyla düşünme hatasına düşerler. "Çok çevresi olan birini alalım, pazarlamacı gibi herkese satsın." İşte bu düşünceyi de değiştirmemiz gerekiyor.

**İş Gücü Paylaşımı ve Eğitimin Önemi:**
Getirdiğiniz ilk 5 kişi yeteri kadar bilgi, eğitim ve destek alırsa, onlardan sonra gelecek kişilere de iş yükü paylaşmış ve bilinçli bir topluluk inşa etmiş oluruz. Aslında bu, bir nevi karşılıklı alışveriştir. Ekibimize dahil ettiğimiz insanları eğitmek ve onlara destek olmamız gereklidir.

İş gücü paylaşımına ve eğitime örnek verecek olursak: Üst kollarınızdan aldığınız eğitimleri, getirdiğiniz 5 kişiye verdiğiniz zaman, eğitim verdiğiniz 5 kişi de getirdikleri 25 kişinin eğitimini üstlenecektir. O 25 kişi de, getirecekleri 125 kişinin eğitimini üstlenecektir.

Bu şekilde hem bilinçli ve eğitimli bir topluluk inşa etmiş olurken, iş yükü de azalmış olacaktır. Aynı zamanda bu eğitimleri alırken ve verirken kimse tek başına değildir.

10 kişi masayı taşırken enteresandır ki, hepsinin ortak bir düşüncesi vardır: "Ben arazi oluyorum, ben tutmuyorum, diğerleri taşıyor." Aslında hepsine aynı yük gelir. İşte bu sayının gücüdür. Eğer yük paylaşılırsa kimse yorulmaz.

**Geleneksel ve Network Ticaret Mantığı Arasındaki Zaman Farkı:**
Normal bir işçi veya beyaz yakalıyı düşünelim. 6 ay zaman diliminde zaman çok kısadır. Nedeni ise: Düşünce tarzlarından kaynaklanmaktadır.

Geleneksel işlerde insanlar genellikle "Ay bitsin de maaşımı alayım." düşüncesindedir. Bu yüzden zaman onlar için çabuk geçsin isterler. Yarım yılın hepsini sadece alacağı maaşa odaklanıyorlar.

Network'te ise tam tersidir; burada insanlar zamanı uzatmak, daha çok üretmek ve sistemini büyütmek ister.

- Network'te: "Zaman geçmesin" diye uğraşılırken,
- Geleneksel ticarette: "Zaman geçsin" diye uğraşılır.

İlginçtir ki, geleneksel düşüncede "Geçsin, bitsin" diye uğraşılan şey aslında zamandır. Hayatta telafisi olmayan tek şey. Böylesine kıymetli bir şeyi "Zamanın geçmesi için harcanan bir iş" nasıl güzel olabilir ki?

**Özetle, Network Marketing:**
Network Marketing, yalnızca satış ya da çevreye bağlı bir sistem değildir. Bilgi, eğitim ve ekip çalışmasının doğru harmanlandığı bir yapıdır. Bu anlayışla hareket eden kişiler, uzun vadede hem kendi gelişimlerini hem de ekiplerinin başarısını garanti altına alırlar.
            `.trim()
        },                    
                    { type: 'link', title: 'PDF Dosyası - Peynirimi Kim Kaptı', icon: '🔗', data: 'https://raw.githubusercontent.com/opsdazlakss/education/main/peynir.pdf' },
                    { type: 'video', title: 'Peynirimi Kim Kaptı - Dr. Spencer Johnson', icon: '🎥',    data: 'cT6ZqNnbLAf', platform: 'screenpal'},
                    { type: 'video', title: 'Pablo ve Bruno Türkçe Boru Hattı Hikayesi', icon: '🎥', data: 'https://www.youtube.com/embed/st_6oow4cDo', platform: 'youtube'},
                    { type: 'survey', title: 'Başlangıç Anketi', icon: '📋', data: ['Projeden haberiniz vardı mı?', 'Hangi alanda kullanmayı planlıyorsunuz?', 'Deneyim seviyeniz nedir?'] },
                    {
                        type: 'quiz',
                        title: 'Aşama 1 Testi',
                        icon: '❓',
                        questionCount: 5, // Kaç soru sorulacak
                        stageId: 1 // Hangi havuzdan soru çekilecek
                    }
                ]
            },
            {
                id: 2,
                title: "Düşünce Değişimi",
                description: "Proje yapısı ve ana bileşenleri hakkında bilgi",
                type: "Video",
                contents: [
                    { type: 'video', title: 'Düşünce Değişimi', icon: '🎥', data: 'https://www.youtube.com/embed/HqEE-lU91eQ?list=PL0Hya99D5Lc74omeWpPF34NYJf0zRJ5nY' },
                    { type: 'text', title: 'Mimari Detaylar', icon: '📄', data: 'MAT projesi üç ana katmandan oluşur: Frontend, Backend ve Database. Her katman bağımsız olarak çalışabilir ve modüler yapısı sayesinde kolay genişletilebilir.' },
                    { type: 'link', title: 'GitHub Deposu', icon: '🔗', data: 'https://github.com/mat/project' },
                    {
                        type: 'quiz',
                        title: 'Aşama 1 Testi',
                        icon: '❓',
                        questionCount: 5, // Kaç soru sorulacak
                        stageId: 1 // Hangi havuzdan soru çekilecek
                    }
                ]
            },
            {
                id: 3,
                title: "9 TEMEL SUTUN",
                description: "Proje vizyonu ve hedeflerimiz",
                type: "1",
                contents: [
                    { type: 'text', title: 'Vizyon Metni', icon: '📄', data: 'Vizyonumuz: Dünyanın en erişilebilir ve kullanıcı dostu teknoloji platformu olmak. Misyonumuz: Herkesin teknolojiye erişebilmesini sağlamak ve açık kaynak topluluğunu güçlendirmek.' },
                    { type: 'video', title: '9 TEMEL SUTUN - 1: HAYAL HEDEF NEDENLERİMİZ', icon: '🎥', data: 'https://www.youtube.com/embed/S7aS6Qdfmuo?list=PL0Hya99D5Lc74omeWpPF34NYJf0zRJ5nY' },
                    { type: 'survey', title: 'Görüş Anketi', icon: '📋', data: ['Projemizin vizyonu size ne ifade ediyor?', 'Hangi özellik en çok ilginizi çekti?'] }
                ]
            },
            {
                id: 4,
                title: "9 TEMEL SUTUN",
                description: "Teknik implementasyon ve altyapı detayları",
                type: "2",
                contents: [
                    { type: 'video', title: '9 TEMEL SUTUN - 2: TAAHHÜT', icon: '🎥', data: 'https://www.youtube.com/embed/LDc4DC6ufaQ?list=PL0Hya99D5Lc74omeWpPF34NYJf0zRJ5nY' },
                    { type: 'text', title: 'API Dokümantasyonu', icon: '📄', data: 'REST API: Tüm uç noktalarımız RESTful standartlarını takip eder. Authentication: JWT tabanlı kimlik doğrulama kullanılır. Rate Limiting: API çağrılarında oran sınırlandırması uygulanır.' },
                    { type: 'link', title: 'Teknik Belgeleri', icon: '🔗', data: 'https://tech-docs.example.com' }
                ]
            },
            {
                id: 5,
                title: "9 TEMEL SUTUN",
                description: "Proje yol haritası ve milestone'lar",
                type: "3",
                contents: [
                    { type: 'text', title: 'Yol Haritası Metni', icon: '📄', data: 'Q1 2024: Temel özellikler tamamlanacak. Q2 2024: Entegrasyon ve test aşaması. Q3 2024: Beta sürümü açık olacak. Q4 2024: Resmi 1.0 sürümü piyasaya çıkacak.' },
                    { type: 'video', title: '9 TEMEL SUTUN - 3: Kişi Listesi', icon: '🎥', data: 'https://www.youtube.com/embed/LDc4DC6ufaQ?list=PL0Hya99D5Lc74omeWpPF34NYJf0zRJ5nY' },
                    { type: 'link', title: 'Etkileşimli Roadmap', icon: '🔗', data: 'https://roadmap.example.com' },
                    { type: 'survey', title: 'Öncelik Anketi', icon: '📋', data: ['Hangi özellik önce gelmelidir?', 'Neler eksik olduğunu düşünüyorsunuz?'] }
                ]
            },
            {
                id: 6,
                title: "9 TEMEL SUTUN",
                description: "Komunite ile etkileşim ve geri bildirim",
                type: "4",
                contents: [
                    { type: 'survey', title: 'Topluluk Geri Bildirimi', icon: '📋', data: ['Projemizi nasıl değerlendiriyorsunuz?', 'Hangi alanlarda iyileştirme yapılmalı?', 'Proje hakkında tavsiye ve önerileriniz nelerdir?'] },
                    { type: 'video', title: '9 TEMEL SUTUN - 4: DAVET', icon: '🎥', data: 'https://www.youtube.com/embed/FBp3fJLjMMo?list=PL0Hya99D5Lc74omeWpPF34NYJf0zRJ5nY' },
                    { type: 'text', title: 'Katılım Rehberi', icon: '📄', data: 'Projeye katkı sağlamak için GitHub üzerinden Pull Request açabilirsiniz. Önce Issues sekmesini kontrol edin, eğer benzer bir sorun varsa ona yorum yapın. Yeni özellik önerileri için Discussion açın.' },
                    { type: 'link', title: 'Discord Sunucusu', icon: '🔗', data: 'https://discord.gg/matproject' }
                ]
            },
            {
                id: 7,
                title: "9 TEMEL SUTUN",
                description: "Gerçek dünya senaryoları ve örnekler",
                type: "5",
                contents: [
                    { type: 'video', title: '9 TEMEL SUTUN - 5: SUNUM', icon: '🎥', data: 'https://www.youtube.com/embed/V9MdAFV-MAQ?list=PL0Hya99D5Lc74omeWpPF34NYJf0zRJ5nY' },
                    { type: 'text', title: 'Kod Örnekleri', icon: '📄', data: 'Örnek 1: Basit API çağrısı\nconst response = await fetch(\'https://api.mat.com/data\');\n\nÖrnek 2: Veri işleme\nconst data = response.json();\ndata.forEach(item => console.log(item));' },
                    { type: 'link', title: 'Demo Projeleri', icon: '🔗', data: 'https://github.com/mat/examples' }
                ]
            },
            {
                id: 8,
                title: "9 TEMEL SUTUN",
                description: "Daha derinlemesine teknik konular",
                type: "6",
                contents: [
                    { type: 'video', title: '9 TEMEL SUTUN - 6: TAKİP ve GÖRÜŞME', icon: '🎥', data: 'https://www.youtube.com/embed/qCitqOEvVL8?list=PL0Hya99D5Lc74omeWpPF34NYJf0zRJ5nY' },
                    { type: 'text', title: 'Detaylı Rehber', icon: '📄', data: 'Scalability: Veritabanı optimizasyonu ve caching stratejileri. Security: Encryption, authentication ve authorization mekanizmaları. Performance: Load balancing ve CDN kullanımı.' },
                    { type: 'survey', title: 'Bilgi Testi', icon: '📋', data: ['API authentication nasıl yapılır?', 'Veritabanı optimizasyonunun önemi nedir?', 'Rate limiting neden gereklidir?'] }
                ]
            },
            {
                id: 9,
                title: "9 TEMEL SUTUN",
                description: "Tüm öğrenilenlerin uygulandığı final projesi",
                type: "7",
                contents: [
                    { type: 'video', title: '9 TEMEL SUTUN - 7: KOORDİNASYON', icon: '🎥', data: 'https://www.youtube.com/embed/xxOScdUrgrs?list=PL0Hya99D5Lc74omeWpPF34NYJf0zRJ5nY' },
                    { type: 'text', title: 'Proje Gereksinimleri', icon: '📄', data: '1. MAT API\'sini kullanarak bir uygulama geliştirin\n2. Minimum 3 endpoint kullanmalı\n3. Hata yönetimi ve validasyon gerekli\n4. README dosyası ile dokümantasyon yapın\n5. GitHub\'da public repository oluşturun' },
                    { type: 'link', title: 'Başlangıç Şablonu', icon: '🔗', data: 'https://github.com/mat/starter-template' },
                    { type: 'survey', title: 'Final Değerlendirmesi', icon: '📋', data: ['Proje tamamlanmış mı?', 'Neler öğrendiniz?', 'Geri bildirim ve gelecek planlarınız'] }
                ]
            },
            {
                id: 10,
                title: "9 TEMEL SUTUN",
                description: "9 TEMEL SUTUN",
                type: "8",
                contents: [
                    { type: 'video', title: '9 TEMEL SUTUN - 8: ÇOĞALTMA', icon: '🎥', data: 'https://www.youtube.com/embed/l7DDWmbrFIs?list=PL0Hya99D5Lc74omeWpPF34NYJf0zRJ5nY' },
                    { type: 'text', title: 'Detaylı Rehber', icon: '📄', data: 'Scalability: Veritabanı optimizasyonu ve caching stratejileri. Security: Encryption, authentication ve authorization mekanizmaları. Performance: Load balancing ve CDN kullanımı.' },
                    { type: 'survey', title: 'Bilgi Testi', icon: '📋', data: ['API authentication nasıl yapılır?', 'Veritabanı optimizasyonunun önemi nedir?', 'Rate limiting neden gereklidir?'] }
                ]
            },
            {
                id: 11,
                title: "9 TEMEL SUTUN",
                description: "9 TEMEL SUTUN",
                type: "9",
                contents: [
                    { type: 'video', title: '9 TEMEL SUTUN - 9: YÜCELTME', icon: '🎥', data: 'https://www.youtube.com/embed/Ok4J-npA5Rk?list=PL0Hya99D5Lc74omeWpPF34NYJf0zRJ5nY' },
                    { type: 'text', title: 'Detaylı Rehber', icon: '📄', data: 'Scalability: Veritabanı optimizasyonu ve caching stratejileri. Security: Encryption, authentication ve authorization mekanizmaları. Performance: Load balancing ve CDN kullanımı.' },
                    { type: 'survey', title: 'Bilgi Testi', icon: '📋', data: ['API authentication nasıl yapılır?', 'Veritabanı optimizasyonunun önemi nedir?', 'Rate limiting neden gereklidir?'] }
                ]
            },
        ];

        let currentStage = 1;
        let completedContents = {};

        async function renderStages() {
            const stagesList = document.getElementById('stagesList');
            stagesList.innerHTML = '';
        
            for (const stage of stages) {
                // Aşamaya erişim kontrolü
                const isLocked = !(await canAccessStage(stage.id));
                
                // Bu aşamanın tamamlanma durumunu kontrol et
                let stageCompletedContents = {};
                if (userProgress && 
                    userProgress.completedStages && 
                    userProgress.completedStages[stage.id] && 
                    userProgress.completedStages[stage.id].completedContents) {
                    stageCompletedContents = userProgress.completedStages[stage.id].completedContents;
                }
                
                // Tamamlanan içerik sayısını hesapla
                let completedCount = 0;
                for (let i = 0; i < stage.contents.length; i++) {
                    const contentId = `${stage.id}-${i}`;
                    if (stageCompletedContents[contentId]) {
                        completedCount++;
                    }
                }
                
                // Aşama tamamen tamamlanmış mı?
                const isCompleted = completedCount === stage.contents.length;
                
                // Bu aşama şu anda seçili mi?
                const isActive = currentStage === stage.id;
        
                // İkon belirleme
                let icon = '⭕'; // Varsayılan
                if (isLocked) {
                    icon = '🔒'; // Kilitli
                } else if (isCompleted) {
                    icon = '✅'; // Tamamlanmış
                } else if (isActive) {
                    icon = '🔵'; // Aktif/Devam Eden
                }
        
                // Buton oluştur
                const btn = document.createElement('button');
                btn.className = `stage-btn ${isActive ? 'active' : ''}`;
                btn.disabled = isLocked;
                
                btn.innerHTML = `
                    <div class="stage-btn-header">
                        <span class="stage-icon">${icon}</span>
                        <div class="stage-info">
                            <span class="stage-title">${stage.title}</span>
                            <span class="stage-type">${stage.type}</span>
                        </div>
                    </div>
                    ${!isLocked ? `<div class="stage-status">${completedCount}/${stage.contents.length} içerik tamamlandı</div>` : '<div class="stage-status">🔒 Kilitli</div>'}
                `;
        
                btn.onclick = () => {
                    if (!isLocked) {
                        currentStage = stage.id;
                        updateCompletedContentsForStage(currentStage);
                        render();
                    }
                };
        
                stagesList.appendChild(btn);
            }
        }


        function renderContent() {
            const stageData = stages[currentStage - 1];
            document.getElementById('stageId').textContent = currentStage;
            document.getElementById('stageTypeLabel').textContent = stageData.type;
            document.getElementById('stageTitle').textContent = stageData.title;
            document.getElementById('stageDescription').textContent = stageData.description;
            document.getElementById('currentStageDisplay').textContent = currentStage;
            document.getElementById('totalCount').textContent = stageData.contents.length;
        
            const contentList = document.getElementById('contentList');
            contentList.innerHTML = '';
        
            stageData.contents.forEach((content, idx) => {
                const contentId = `${currentStage}-${idx}`;
                const isCompleted = completedContents[contentId];
        
                const item = document.createElement('button');
                item.className = `content-item ${isCompleted ? 'completed' : ''}`;
                item.style.background = 'none';
                item.style.border = 'none';
                item.style.padding = '0';
        
                const itemInner = document.createElement('div');
                itemInner.className = 'content-item';
                itemInner.style.width = '100%';
                itemInner.innerHTML = `
                    <span class="content-emoji">${content.icon}</span>
                    <div class="content-details">
                        <div class="content-title">${content.title}</div>
                        <div class="content-type">
                            ${content.type === 'text' ? '📝 Metin İçeriği' : ''}
                            ${content.type === 'video' ? '🎥 Video' : ''}
                            ${content.type === 'link' ? '🔗 Harici Link' : ''}
                            ${content.type === 'survey' ? '📋 Anket' : ''}
                        </div>
                    </div>
                    <span class="content-check">${isCompleted ? '✅' : '⭕'}</span>
                `;
        
                item.appendChild(itemInner);
                item.onclick = () => {
                    if (!completedContents[contentId] && !['quiz', 'survey'].includes(content.type)) {
                        completedContents[contentId] = true;
                        markContentCompleted(currentStage, idx);
                    }
                    showContentModal(content);
                    render(); // Güncelleme sonrası UI yenileniyor
                };
        
                contentList.appendChild(item);
            });
        
            updateProgress();
        }


        function updateProgress() {
            const stageData = stages[currentStage - 1];
            const completed = getStageCompletedContentsCount(currentStage);
            document.getElementById('completedCount').textContent = completed;
            const percentage = (completed / stageData.contents.length) * 100;
            document.getElementById('stageProgressFill').style.width = percentage + '%';
            document.getElementById('headerProgressFill').style.width = ((currentStage / stages.length) * 100) + '%';
            document.getElementById('totalStageDisplay').textContent = stages.length;

            document.getElementById('prevBtn').style.display = currentStage > 1 ? 'flex' : 'none';
            
            const nextBtn = document.getElementById('nextBtn');
            const isCompleted = isStageFullyCompleted(currentStage);
            nextBtn.disabled = !isCompleted || currentStage === 9;
            nextBtn.textContent = currentStage === 9 ? 'Tamamlandı! 🎉' : 'Sonraki Aşama →';
        }

        function getRandomQuestions(stageId, count) {
            const pool = quizQuestionPools[stageId] || [];
            if (pool.length === 0) return [];
            
            // Havuzdaki tüm soruları kopyala
            const availableQuestions = [...pool];
            const selectedQuestions = [];
            
            // İstenen sayıda (veya havuzdaki toplam soru sayısı kadar) soru seç
            const questionCount = Math.min(count, availableQuestions.length);
            
            for (let i = 0; i < questionCount; i++) {
                // Rastgele bir index seç
                const randomIndex = Math.floor(Math.random() * availableQuestions.length);
                // Soruyu ekle
                selectedQuestions.push(availableQuestions[randomIndex]);
                // Seçilen soruyu havuzdan çıkar (tekrar seçilmesin)
                availableQuestions.splice(randomIndex, 1);
            }
            
            return selectedQuestions;
        }

        async function canAccessStage(stageId) {
            if (stageId === 1) return true; // İlk aşama her zaman açık
        
            const prevStageId = stageId - 1;
            
            // userProgress henüz yüklenmediyse false dön
            if (!userProgress || !userProgress.completedStages) {
                return false;
            }
        
            const prevStage = userProgress.completedStages[prevStageId];
            
            // Önceki aşama yoksa erişim yok
            if (!prevStage) {
                return false;
            }
        
            // Reddedilmişse sıfırla
            if (prevStage.approved === false) {
                console.log(`Aşama ${prevStageId} reddedildi, sıfırlanıyor...`);
                try {
                    await db.collection('userProgress').doc(currentUsername).update({
                        [`completedStages.${prevStageId}`]: firebase.firestore.FieldValue.delete()
                    });
                    // userProgress'i güncelle
                    delete userProgress.completedStages[prevStageId];
                } catch (error) {
                    console.error('Aşama sıfırlama hatası:', error);
                }
                return false;
            }
        
            // Önceki aşama onaylanmışsa erişim serbest
            return prevStage.approved === true;
        }




        function isStageFullyCompleted(stageId) {
            return getStageCompletedContentsCount(stageId) === stages[stageId - 1].contents.length;
        }

        function getStageCompletedContentsCount(stageId) {
            let count = 0;
            for (let i = 0; i < stages[stageId - 1].contents.length; i++) {
                if (completedContents[`${stageId}-${i}`]) count++;
            }
            return count;
        }

        //ben bu fonksiyonun taaa aq
        function showContentModal(content) {
            const modal = document.getElementById('contentModal');
            const modalBody = document.getElementById('modalBody');
            document.getElementById('modalType').textContent =
                content.type === 'text' ? '📝 METİN' :
                content.type === 'video' ? '🎥 VİDEO' :
                content.type === 'link' ? '🔗 LİNK' :
                content.type === 'survey' ? '📋 ANKET' :
                '❓ QUIZ';
            document.getElementById('modalTitle').textContent = content.title;

            if (content.type === 'quiz') {
                // Rastgele sorular seç
                const quizQuestions = getRandomQuestions(content.stageId, content.questionCount);
                
                if (quizQuestions.length === 0) {
                    modalBody.innerHTML = '<p style="color: #ef4444; text-align: center;">Soru havuzu boş!</p>';
                    modal.classList.add('active');
                    return;
                }
                
                // Seçilen soruları content'e ekle
                content.questions = quizQuestions;
                
                // İlk soruyu göster
                currentQuizIndex = 0;
                currentQuizAnswers = new Array(quizQuestions.length).fill(null);
                
                const currentQ = quizQuestions[currentQuizIndex];
                let optionsHTML = currentQ.options.map((opt, idx) => `
                    <button class="quiz-option" data-answer="${opt}">${opt}</button>
                `).join('');

                modalBody.innerHTML = `
                    <div class="quiz-box">
                        <div class="quiz-progress-info">Soru ${currentQuizIndex + 1} / ${quizQuestions.length}</div>
                        <p class="quiz-question">${currentQ.question}</p>
                        <div class="quiz-options" id="quizOptionsContainer">${optionsHTML}</div>
                        <p id="quizResult" class="quiz-result"></p>
                        <div class="quiz-navigation" style="margin-top: 1.5rem; display: none;">
                            <button class="btn btn-secondary" id="quizNextBtn">Sonraki Soru →</button>
                        </div>
                    </div>
                `;

                document.querySelectorAll('.quiz-option').forEach(btn => {
                    btn.onclick = () => checkMultiQuizAnswer(btn, content);
                });
            } 
            // Diğer içerik tipleri aynı kalacak...
            else if (content.type === 'text') {
                modalBody.innerHTML = `<div class="text-content">${content.data}</div>`;
            } 
            else if (content.type === 'video') {
                if (content.platform === 'screenpal') {
                    // ScreenPal embed kodu
                    modalBody.innerHTML = `
                        <div class="video-container">
                            <div class="sp-embed-player" data-id="${content.data}">
                                <script src="https://go.screenpal.com/player/appearance/${content.data}"><\/script>
                                <iframe width="100%" height="100%" style="border:0;" scrolling="no" 
                                    src="https://go.screenpal.com/player/${content.data}?width=100%&height=100%&ff=1&title=0" 
                                    allowfullscreen="true">
                                </iframe>
                            </div>
                        </div>
                    `;
                } else {
                    // YouTube veya diğer platformlar
                    modalBody.innerHTML = `
                        <div class="video-container">
                            <iframe src="${content.data}" frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                            </iframe>
                        </div>
                    `;
                }
            } 
            else if (content.type === 'link') {
                modalBody.innerHTML = `<div class="link-box"><a href="${content.data}" target="_blank" class="link-btn">Linki Aç →</a><div class="link-url">${content.data}</div></div>`;
            } 
            else if (content.type === 'survey') {
                let questionsHTML = '<div class="survey-questions">';
                content.data.forEach((question, idx) => {
                    questionsHTML += `
                        <div class="question-box">
                            <div class="question-number">${idx + 1}. ${question}</div>
                            <textarea class="question-textarea" placeholder="Cevabınızı yazın..."></textarea>
                        </div>
                    `;
                });
            
                // Anket gönderim butonunda stageId ve contentIndex parametreleri geçiyoruz
                questionsHTML += `
                    <button class="submit-survey-btn" onclick="submitSurvey(${currentStage}, ${stages[currentStage - 1].contents.indexOf(content)})">
                        Anketi Gönder
                    </button>
                `;
                questionsHTML += '</div>';
                modalBody.innerHTML = questionsHTML;
            }
            modal.classList.add('active');
        }    
            
        function checkQuizAnswer(button, selected, correct) {
            const result = document.getElementById('quizResult');
            const buttons = button.parentNode.querySelectorAll('.quiz-option');
            buttons.forEach(b => b.disabled = true);


            if (selected === correct) {
            result.textContent = '✅ Doğru cevap!';
            result.style.color = '#22c55e';
            setTimeout(() => {
            closeModal();
            render();
            }, 1000);
            } else {
                result.innerHTML = `❌ Yanlış cevap verdiniz.`;
                result.style.color = '#ef4444';
                //result.innerHTML = `❌ Yanlış cevap. Doğru cevap: <b>${correct}</b>`; bu kısım test kısmında eğer doğru cevabı da göstermek istersek olacak şu anlık doğru cevap gösterme yoks
            }
        }
        let currentQuizIndex = 0;
        let currentQuizAnswers = [];
        let currentQuizContent = null;

        function checkMultiQuizAnswer(button, content) {
            const selected = button.getAttribute('data-answer');
            const currentQ = content.questions[currentQuizIndex];
            const result = document.getElementById('quizResult');
            const buttons = document.querySelectorAll('.quiz-option');
            
            buttons.forEach(b => b.disabled = true);

            // Cevabı kaydet
            currentQuizAnswers[currentQuizIndex] = selected;

            if (selected === currentQ.correctAnswer) {
                button.style.background = 'rgba(34, 197, 94, 0.3)';
                button.style.borderColor = '#22c55e';
                result.textContent = '✅ Doğru cevap!';
                result.style.color = '#22c55e';
            } else {
                button.style.background = 'rgba(239, 68, 68, 0.3)';
                button.style.borderColor = '#ef4444';
                result.innerHTML = `❌ Yanlış cevap verdiniz.`;
                result.style.color = '#ef4444';
                //result.innerHTML = `❌ Yanlış cevap. Doğru cevap: <b>${currentQ.correctAnswer}</b>`; //doğru cevabı gösteren kod
            }

            // Son soru değilse "Sonraki Soru" butonunu göster
            if (currentQuizIndex < content.questions.length - 1) {
                document.querySelector('.quiz-navigation').style.display = 'block';
                document.getElementById('quizNextBtn').onclick = () => showNextQuestion(content);
            } else {
                // Son soru - testi bitir
                setTimeout(() => {
                    showQuizResults(content);
                }, 1500);
            }
        }

        function showNextQuestion(content) {
            currentQuizIndex++;
            const currentQ = content.questions[currentQuizIndex];
            
            let optionsHTML = currentQ.options.map(opt => `
                <button class="quiz-option" data-answer="${opt}">${opt}</button>
            `).join('');

            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div class="quiz-box">
                    <div class="quiz-progress-info">Soru ${currentQuizIndex + 1} / ${content.questions.length}</div>
                    <p class="quiz-question">${currentQ.question}</p>
                    <div class="quiz-options">${optionsHTML}</div>
                    <p id="quizResult" class="quiz-result"></p>
                    <div class="quiz-navigation" style="margin-top: 1.5rem; display: none;">
                        <button class="btn btn-secondary" id="quizNextBtn">Sonraki Soru →</button>
                    </div>
                </div>
            `;

            document.querySelectorAll('.quiz-option').forEach(btn => {
                btn.onclick = () => checkMultiQuizAnswer(btn, content);
            });
        }

        function showQuizResults(content) {
            let correctCount = 0;
            content.questions.forEach((q, idx) => {
                if (currentQuizAnswers[idx] === q.correctAnswer) correctCount++;
            });
        
            const percentage = Math.round((correctCount / content.questions.length) * 100);
            const passed = correctCount === content.questions.length;
        
            // Quiz sonuçlarını kaydet
            if (passed) {
                const stageData = stages[currentStage - 1];
                stageData.contents.forEach((c, idx) => {
                    if (c.type === 'quiz' && c.title === content.title) {
                        const contentId = `${currentStage}-${idx}`;
                        completedContents[contentId] = true;
                        markContentCompleted(currentStage, idx);
                        
                        // Quiz sonuçlarını Firestore'a kaydet
                        saveQuizResults(currentStage, {
                            quizTitle: content.title,
                            correctAnswers: correctCount,
                            totalQuestions: content.questions.length,
                            percentage: percentage,
                            passed: passed,
                            completedAt: new Date().toISOString()
                        });
                    }
                });
            }
        
            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div class="quiz-box" style="text-align: center;">
                    <div style="font-size: 64px; margin-bottom: 1rem;">${passed ? '🎉' : '📚'}</div>
                    <h2 style="font-size: 28px; color: ${passed ? '#22c55e' : '#ef4444'}; margin-bottom: 1rem;">
                        ${passed ? 'Tebrikler! Tüm Soruları Doğru Cevapladınız!' : 'Tüm Soruları Doğru Cevaplamalısınız'}
                    </h2>
                    <p style="font-size: 18px; margin-bottom: 2rem;">
                        ${correctCount} / ${content.questions.length} doğru cevap
                    </p>
                    ${!passed ? '<p style="color: #94a3b8; margin-bottom: 1rem;">Lütfen testi tekrar deneyin ve tüm soruları doğru cevaplayın.</p>' : ''}
                    <button class="btn btn-primary" onclick="closeModal(); render();">Kapat</button>
                </div>
            `;
        }

        function closeModal() {
            const modal = document.getElementById('contentModal');
            const modalBody = document.getElementById('modalBody');
            
            // Video iframe'lerini durdur
            const iframes = modalBody.querySelectorAll('iframe');
            iframes.forEach(iframe => {
                iframe.src = iframe.src; // Reload ederek durdur
            });
            
            // Modal'ı kapat
            modal.classList.remove('active');
            
            // 300ms sonra içeriği tamamen temizle (animasyon bitince)
            setTimeout(() => {
                modalBody.innerHTML = '';
            }, 300);
        }

        async function submitSurvey(stageId, contentIndex) {
            const textareas = document.querySelectorAll('.question-textarea');
            const answers = [];
            const stageData = stages[stageId - 1];
            const surveyContent = stageData.contents[contentIndex];
        
            textareas.forEach((textarea, idx) => {
                answers.push({
                    question: surveyContent.data[idx],
                    answer: textarea.value.trim()
                });
            });
        
            // Firestore’a kaydet
            await saveSurveyAnswers(stageId, answers);
        
            // ✅ Artık burada tamamlandı sayıyoruz
            completedContents[`${stageId}-${contentIndex}`] = true;
            await markContentCompleted(stageId, contentIndex);
        
            alert('📋 Anket başarıyla gönderildi!');
            closeModal();
            render();
        }

        // Kullanıcı ilerlemesini yükle
        async function loadUserProgress() {
            try {
                const progressDoc = await db.collection('userProgress').doc(currentUsername).get();
        
                if (progressDoc.exists) {
                    userProgress = progressDoc.data();
                    console.log('İlerleme yüklendi:', userProgress);
                } else {
                    userProgress = {
                        completedStages: {},
                        currentStage: 1,
                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    await db.collection('userProgress').doc(currentUsername).set(userProgress);
                }
        
                // Şu anki aşamanın tamamlanma durumunu güncelle
                updateCompletedContentsForStage(currentStage);
        
            } catch (error) {
                console.error('İlerleme yüklenirken hata:', error);
                userProgress = { completedStages: {}, currentStage: 1 };
            }
        }
        function updateCompletedContentsForStage(stageId) {
            if (
                userProgress.completedStages &&
                userProgress.completedStages[stageId] &&
                userProgress.completedStages[stageId].completedContents
            ) {
                completedContents = userProgress.completedStages[stageId].completedContents;
            } else {
                completedContents = {};
            }
        }


        
        // İçerik tamamlandığında kaydet
        async function markContentCompleted(stageId, contentIndex) {
            const contentId = `${stageId}-${contentIndex}`;
            completedContents[contentId] = true;
            
            // Firestore'a kaydet
            try {
                if (!userProgress.completedStages) {
                    userProgress.completedStages = {};
                }
                
                if (!userProgress.completedStages[stageId]) {
                    userProgress.completedStages[stageId] = {
                        completedContents: {},
                        stageData: {}
                    };
                }
                
                userProgress.completedStages[stageId].completedContents = completedContents;
                
                await db.collection('userProgress').doc(currentUsername).update({
                    [`completedStages.${stageId}.completedContents`]: completedContents,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
                
            } catch (error) {
                console.error('İlerleme kaydedilirken hata:', error);
            }
        }
        
        // Anket cevaplarını kaydet
        async function saveSurveyAnswers(stageId, answers) {
            try {
                await db.collection('userProgress').doc(currentUsername).update({
                    [`completedStages.${stageId}.surveyAnswers`]: answers,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error('Anket cevapları kaydedilirken hata:', error);
            }
        }
        
        // Quiz sonuçlarını kaydet
        async function saveQuizResults(stageId, results) {
            try {
                await db.collection('userProgress').doc(currentUsername).update({
                    [`completedStages.${stageId}.quizResults`]: results,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error('Quiz sonuçları kaydedilirken hata:', error);
            }
        }
        
        // Aşama onay talebi gönder
        async function requestStageApproval(stageId) {
            try {
                // 🔹 1. Önce mevcut onay talebi var mı kontrol et
                const existingRequests = await db.collection('approvalRequests')
                    .where('username', '==', currentUsername)
                    .where('stageId', '==', stageId)
                    .where('status', 'in', ['pending', 'approved'])
                    .get();
        
                if (!existingRequests.empty) {
                    alert('❗ Bu aşama için zaten onay talebi gönderilmiş veya onaylanmış.');
                    return;
                }
        
                // 🔹 2. Kullanıcının userProgress belgesini al
                const progressDoc = await db.collection('userProgress').doc(currentUsername).get();
                if (!progressDoc.exists) {
                    alert('❌ İlerleme verisi bulunamadı!');
                    return;
                }
        
                const progressData = progressDoc.data();
                const stageProgress = progressData.completedStages?.[String(stageId)] || {}; // 🔧 Fix burada
        
                // 🔹 3. Kullanıcı bilgilerini al
                const userDoc = await db.collection('users').doc(currentUsername).get();
                const userData = userDoc.data();
        
                // 🔹 4. Aşama bilgisini al
                const stageData = stages[stageId - 1];
        
                // 🔹 5. Onay talebini Firestore’a kaydet
                await db.collection('approvalRequests').add({
                    username: currentUsername,
                    fullname: userData.fullname,
                    stageId: stageId,
                    stageTitle: stageData.title,
                    surveyAnswers: stageProgress.surveyAnswers || [],
                    quizResults: stageProgress.quizResults || null,
                    completedContents: stageProgress.completedContents || {},
                    status: 'pending',
                    requestedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    adminNote: null
                });
        
                alert('✅ Onay talebi gönderildi! Admin onayından sonra devam edebilirsiniz.');
            } catch (error) {
                console.error('Onay talebi gönderilirken hata:', error);
                alert('❌ Onay talebi gönderilemedi!');
            }
        }




        function render() {
            renderStages();
            renderContent();
        }

        document.getElementById('prevBtn').onclick = () => {
            if (currentStage > 1) {
                currentStage--;
                updateCompletedContentsForStage(currentStage);
                render();
            }
        };

        document.getElementById('nextBtn').onclick = async () => {
            if (isStageFullyCompleted(currentStage) && currentStage < stages.length) {
                await requestStageApproval(currentStage);
            }
        };


        document.getElementById('contentModal').onclick = (e) => {
            if (e.target.id === 'contentModal') {
                closeModal();
            }
        };

        render();
    render();
    const quizStyle = document.createElement('style');
    quizStyle.textContent = `
        .quiz-box { text-align: center; padding: 1rem; }
        .quiz-question { font-size: 18px; margin-bottom: 1.5rem; color: #e2e8f0; font-weight: 500; line-height: 1.6; }
        .quiz-options { display: flex; flex-direction: column; gap: 0.75rem; margin-top: 1.5rem; }
        .quiz-option { 
            background: rgba(30,41,59,0.5); 
            border: 1px solid #334155; 
            border-radius: 8px; 
            padding: 1rem 1.5rem; 
            cursor: pointer; 
            color: #e2e8f0; 
            transition: all 0.2s;
            font-size: 15px;
            font-weight: 500;
            text-align: center;
            width: 100%;
            font-family: inherit;
        }
        .quiz-option:hover:not(:disabled) { 
            background: rgba(59,130,246,0.3); 
            border-color: #3b82f6;
            transform: translateX(4px);
        }
        .quiz-option:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .quiz-result { 
            margin-top: 1.5rem; 
            font-weight: 600; 
            font-size: 16px;
            padding: 1rem;
            border-radius: 8px;
            background: rgba(30,41,59,0.3);
        }
        `;
    document.head.appendChild(quizStyle);

        // Global değişkenler

        
        // Kullanıcı giriş kontrolü
        auth.onAuthStateChanged(async (user) => {
            if (!user) {
                // Kullanıcı çıkış yaptıysa login sayfasına yönlendir
                window.location.href = 'login.html';
                return;
            }
        
            // Aktif kullanıcı bilgilerini ayarla
            currentUser = user;
            currentUsername = user.email.split('@')[0];
        
            try {
                // Firestore'dan kullanıcı bilgilerini al
                const userDoc = await db.collection('users').doc(currentUsername).get();
        
                if (!userDoc.exists) {
                    console.error('Kullanıcı Firestore’da bulunamadı.');
                    await auth.signOut();
                    window.location.href = 'login.html';
                    return;
                }
        
                const userData = userDoc.data();
                console.log(`Hoşgeldin: ${userData.fullname}`);
        
                await loadUserProgress();
        
                await renderStages();
        
                renderContent();
        
                if (userData.isAdmin) {
                    const adminBtn = document.getElementById('adminButton');
                    if (adminBtn) adminBtn.style.display = 'block';
                }
        
                console.log('Kullanıcı verileri ve aşamalar başarıyla yüklendi.');
        
            } catch (error) {
                console.error('Kullanıcı bilgisi alınamadı:', error);
                const errorMessage = document.getElementById('errorMessage');
                if (errorMessage) {
                    errorMessage.textContent = 'Kullanıcı bilgileri yüklenemedi. Lütfen tekrar giriş yapın.';
                    errorMessage.classList.add('show');
                }
            }
        });
        



        // Çıkış fonksiyonu
        function userLogout() {
            if (confirm('Çıkış yapmak istediğinize emin misiniz?')) {
                auth.signOut().then(() => {
                    window.location.href = 'login.html';
                });
            }
        }
    </script>
</body>
</html>
